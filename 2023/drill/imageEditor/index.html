<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    .edit {
        width: 400px;
        padding: 10px;
        margin: 50px auto;
        border: 2px dashed #ddd;
        border-radius: 10px;
        outline: none;
        caret-color: skyblue;
        overflow: auto;
    }
</style>

<body>
    <div class="edit" contenteditable>

    </div>
</body>
<script>
    window.addEventListener('load', () => {
        const edit = document.querySelector('.edit');
        const cancelDefault = (e) => {
            e.preventDefault();
        };
        const getFile = (fileEntry) => {
            return new Promise((resolve, _) => {
                fileEntry.file((file) => {
                    resolve(file)
                })
            })
        }
        const handleDataTransfer = async ({ dataTransfer }) => {
            edit.style.cursor = 'text'
            if (!dataTransfer) {
                return console.warn('browser not support drop api')
            }
            const { items } = dataTransfer;
            const imageList = [];
            for (let item of items) {
                const file = await getFile(item.webkitGetAsEntry());
                    imageList.push(file)
            }
            imageList.forEach(image => {
                const img = document.createElement('video');
                img.width = 300;
                img.setAttribute('control','control')
                img.setAttribute('autoplay','autoplay')
                src = URL.createObjectURL(image);
                console.log(src);
                img.src= src;
                edit.appendChild(img);
            })
        }
        const handleSelectionChange = (e) => {
            console.log(e);
        }
        edit.addEventListener('selectionchange', handleSelectionChange);
        edit.addEventListener('drop', cancelDefault)
        edit.addEventListener('dragenter', cancelDefault)
        edit.addEventListener('dragover', cancelDefault)
        edit.addEventListener('drop', handleDataTransfer)
    })


    function pasteHtmlAtCaret(html) {

        var sel, range;

        if (window.getSelection) {

            sel = window.getSelection();

            if (sel.getRangeAt && sel.rangeCount) {

                range = sel.getRangeAt(0);

                range.deleteContents();

                var el = document.createElement("div");

                el.innerHTML = html;

                var frag = document.createDocumentFragment(), node, lastNode;

                while ((node = el.firstChild)) {

                    lastNode = frag.appendChild(node);

                };

                range.insertNode(frag);

                if (lastNode) {

                    range = range.cloneRange();

                    range.setStartAfter(lastNode);

                    range.collapse(true);

                    sel.removeAllRanges();

                    sel.addRange(range);

                };

            };

        } else if (document.selection && document.selection.type != "Control") {

            // IE9以下

            document.selection.createRange().pasteHTML(html);

        };

    };
</script>

</html>